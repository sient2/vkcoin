<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Exchange</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            min-height: 100vh;
            color: #fff;
            padding: 15px;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 8px;
            flex: 1;
            margin: 0 5px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
            color: #43cea2;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
            height: 250px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(67, 206, 162, 0.3);
        }
        
        .chart {
            width: 100%;
            height: 100%;
        }
        
        .price-display {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin: 15px 0;
            color: #43cea2;
            text-shadow: 0 0 10px rgba(67, 206, 162, 0.5);
        }
        
        .price-change {
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
            padding: 8px;
            border-radius: 10px;
        }
        
        .positive {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .negative {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .trade-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .trade-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .buy-btn {
            background: linear-gradient(145deg, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .sell-btn {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .trade-btn:active {
            transform: scale(0.98);
        }
        
        .trade-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .input-group {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .input-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .amount-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 18px;
            text-align: center;
        }
        
        .amount-input:focus {
            outline: none;
            border-color: #43cea2;
        }
        
        .portfolio {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .portfolio-title {
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .portfolio-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .portfolio-item:last-child {
            border-bottom: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            text-align: center;
        }
        
        .notification.error {
            background: rgba(231, 76, 60, 0.9);
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .chart-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .chart-line {
            stroke: #43cea2;
            stroke-width: 3;
            fill: none;
            filter: url(#glow);
        }
        
        .chart-area {
            fill: url(#chartGradient);
            opacity: 0.4;
        }
        
        .current-price-line {
            stroke: rgba(255, 255, 255, 0.5);
            stroke-width: 1;
            stroke-dasharray: 5, 5;
        }
        
        .current-price-label {
            fill: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }
        
        .max-min-labels {
            font-size: 11px;
            fill: rgba(255, 255, 255, 0.8);
            font-weight: bold;
        }
        
        .time-labels {
            font-size: 10px;
            fill: rgba(255, 255, 255, 0.6);
        }
        
        .last-change {
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .positive-change {
            color: #2ecc71;
        }
        
        .negative-change-3 {
            color: #f39c12;
        }
        
        .negative-change-10 {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="font-size: 24px; margin-bottom: 15px; text-align: center;">üìà Crypto Exchange</h1>
            <div class="stats">
                <div class="stat-box">
                    <div style="font-size: 13px;">–ë–∞–ª–∞–Ω—Å</div>
                    <div class="stat-value" id="balance">‚ÇΩ5.00</div>
                </div>
                <div class="stat-box">
                    <div style="font-size: 13px;">–ú–æ–Ω–µ—Ç—ã</div>
                    <div class="stat-value" id="coins">0.00</div>
                </div>
                <div class="stat-box">
                    <div style="font-size: 13px;">–ü–æ—Ä—Ç—Ñ–µ–ª—å</div>
                    <div class="stat-value" id="portfolio">‚ÇΩ5.00</div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-grid"></div>
            <svg class="chart" id="priceChart"></svg>
        </div>

        <div class="price-display" id="currentPrice">‚ÇΩ5.01</div>
        <div class="price-change positive" id="priceChange">+0.00 (0.00%)</div>
        <div class="last-change" id="lastChange">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: <span class="positive-change">+1.00% (80% —à–∞–Ω—Å)</span></div>

        <div class="input-group">
            <div class="input-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç</div>
            <input type="number" class="amount-input" id="amountInput" value="1" min="0.1" step="0.1">
        </div>

        <div class="trade-buttons">
            <button class="trade-btn buy-btn" onclick="trade('buy')">–ö—É–ø–∏—Ç—å</button>
            <button class="trade-btn sell-btn" onclick="trade('sell')">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>

        <div class="portfolio">
            <div class="portfolio-title">–í–∞—à –ø–æ—Ä—Ç—Ñ–µ–ª—å</div>
            <div class="portfolio-item">
                <span>–ú–æ–Ω–µ—Ç—ã:</span>
                <span id="portfolioCoins">0.00</span>
            </div>
            <div class="portfolio-item">
                <span>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</span>
                <span id="avgPrice">‚ÇΩ0.00</span>
            </div>
            <div class="portfolio-item">
                <span>–ü—Ä–∏–±—ã–ª—å/–£–±—ã—Ç–æ–∫:</span>
                <span id="profit" class="positive">‚ÇΩ0.00</span>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
        vkBridge.send('VKWebAppInit');

        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            balance: 20000,
            coins: 0.00,
            coinPrice: 5.00,
            priceHistory: [],
            portfolio: {
                totalCoins: 0.00,
                totalInvested: 0.00
            },
            lastChange: "+1.00% (80% —à–∞–Ω—Å)"
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω
        function generateInitialHistory() {
            const initialPrice = 5.01;
            gameData.priceHistory = [];
            let currentPrice = initialPrice;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 50 —Ç–æ—á–µ–∫ –∏—Å—Ç–æ—Ä–∏–∏
            for (let i = 49; i >= 0; i--) {
                gameData.priceHistory.push({
                    time: Date.now() - i * 5000,
                    price: currentPrice
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadGame() {
            const saved = localStorage.getItem('cryptoExchange');
            if (saved) {
                gameData = JSON.parse(saved);
            } else {
                generateInitialHistory();
            }
            updateUI();
            drawChart();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveGame() {
            localStorage.setItem('cryptoExchange', JSON.stringify(gameData));
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –º–æ–Ω–µ—Ç—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏
        function updatePrice() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100
            const random = Math.random() * 100;
            let changePercent = 0;
            let changeDescription = "";
            let changeClass = "";
            
            if (random < 80) {
                // 80% —à–∞–Ω—Å: +1%
                changePercent = 1;
                changeDescription = "+1.00% (80% —à–∞–Ω—Å)";
                changeClass = "positive-change";
            } else if (random < 95) {
                // 15% —à–∞–Ω—Å: -3%
                changePercent = -3;
                changeDescription = "-3.00% (15% —à–∞–Ω—Å)";
                changeClass = "negative-change-3";
            } else {
                // 5% —à–∞–Ω—Å: -10%
                changePercent = -10;
                changeDescription = "-10.00% (5% —à–∞–Ω—Å)";
                changeClass = "negative-change-10";
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã
            const changeAmount = gameData.coinPrice * (changePercent / 100);
            gameData.coinPrice += changeAmount;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
            if (gameData.coinPrice < 0.01) {
                gameData.coinPrice = 0.01;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            gameData.lastChange = changeDescription;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Ç–æ—á–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é
            gameData.priceHistory.push({
                time: Date.now(),
                price: gameData.coinPrice
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 —Ç–æ—á–∫–∞–º–∏
            if (gameData.priceHistory.length > 50) {
                gameData.priceHistory.shift();
            }
            
            updateUI(changeClass);
            drawChart();
            saveGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI(changeClass) {
            document.getElementById('balance').textContent = '‚ÇΩ' + gameData.balance.toFixed(2);
            document.getElementById('coins').textContent = gameData.coins.toFixed(2);
            document.getElementById('currentPrice').textContent = '‚ÇΩ' + gameData.coinPrice.toFixed(2);
            
            // –†–∞—Å—á–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
            const portfolioValue = gameData.coins * gameData.coinPrice;
            document.getElementById('portfolio').textContent = '‚ÇΩ' + (gameData.balance + portfolioValue).toFixed(2);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã
            if (gameData.priceHistory.length > 1) {
                const previousPrice = gameData.priceHistory[gameData.priceHistory.length - 2].price;
                const change = gameData.coinPrice - previousPrice;
                const changePercent = (change / previousPrice) * 100;
                
                const priceChangeElement = document.getElementById('priceChange');
                priceChangeElement.textContent = (change >= 0 ? '+' : '') + change.toFixed(4) + ' (' + (change >= 0 ? '+' : '') + changePercent.toFixed(2) + '%)';
                
                if (change >= 0) {
                    priceChangeElement.className = 'price-change positive';
                } else {
                    priceChangeElement.className = 'price-change negative';
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            const lastChangeElement = document.getElementById('lastChange');
            lastChangeElement.innerHTML = '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: <span class="' + (changeClass || 'positive-change') + '">' + gameData.lastChange + '</span>';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è
            document.getElementById('portfolioCoins').textContent = gameData.coins.toFixed(2);
            
            if (gameData.portfolio.totalCoins > 0) {
                const avgPrice = gameData.portfolio.totalInvested / gameData.portfolio.totalCoins;
                document.getElementById('avgPrice').textContent = '‚ÇΩ' + avgPrice.toFixed(2);
                
                const profit = (gameData.coinPrice - avgPrice) * gameData.coins;
                const profitElement = document.getElementById('profit');
                profitElement.textContent = (profit >= 0 ? '+' : '') + '‚ÇΩ' + Math.abs(profit).toFixed(2);
                
                if (profit >= 0) {
                    profitElement.className = 'positive';
                } else {
                    profitElement.className = 'negative';
                }
            } else {
                document.getElementById('avgPrice').textContent = '‚ÇΩ0.00';
                document.getElementById('profit').textContent = '‚ÇΩ0.00';
                document.getElementById('profit').className = 'positive';
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
        function drawChart() {
            const chart = document.getElementById('priceChart');
            const container = document.querySelector('.chart-container');
            
            // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            chart.innerHTML = '';
            
            if (gameData.priceHistory.length < 2) return;
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            chart.setAttribute('width', width);
            chart.setAttribute('height', height);
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º—É–º –∏ –º–∞–∫—Å–∏–º—É–º –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            const prices = gameData.priceHistory.map(point => point.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice || 1; // –∏–∑–±–µ–≥–∞–µ–º –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º
            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            gradient.setAttribute('id', 'chartGradient');
            gradient.setAttribute('x1', '0%');
            gradient.setAttribute('y1', '0%');
            gradient.setAttribute('x2', '0%');
            gradient.setAttribute('y2', '100%');
            
            const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop1.setAttribute('offset', '0%');
            stop1.setAttribute('stop-color', '#43cea2');
            stop1.setAttribute('stop-opacity', '0.6');
            
            const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop2.setAttribute('offset', '100%');
            stop2.setAttribute('stop-color', '#43cea2');
            stop2.setAttribute('stop-opacity', '0.1');
            
            gradient.appendChild(stop1);
            gradient.appendChild(stop2);
            
            // –§–∏–ª—å—Ç—Ä —Å–≤–µ—á–µ–Ω–∏—è
            const filter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            filter.setAttribute('id', 'glow');
            filter.setAttribute('x', '-50%');
            filter.setAttribute('y', '-50%');
            filter.setAttribute('width', '200%');
            filter.setAttribute('height', '200%');
            
            const feGaussianBlur = document.createElementNS('http://www.w3.org/2000/svg', 'feGaussianBlur');
            feGaussianBlur.setAttribute('stdDeviation', '3');
            feGaussianBlur.setAttribute('result', 'coloredBlur');
            
            const feMerge = document.createElementNS('http://www.w3.org/2000/svg', 'feMerge');
            const feMergeNode1 = document.createElementNS('http://www.w3.org/2000/svg', 'feMergeNode');
            feMergeNode1.setAttribute('in', 'coloredBlur');
            const feMergeNode2 = document.createElementNS('http://www.w3.org/2000/svg', 'feMergeNode');
            feMergeNode2.setAttribute('in', 'SourceGraphic');
            
            feMerge.appendChild(feMergeNode1);
            feMerge.appendChild(feMergeNode2);
            
            filter.appendChild(feGaussianBlur);
            filter.appendChild(feMerge);
            
            defs.appendChild(gradient);
            defs.appendChild(filter);
            chart.appendChild(defs);
            
            // –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const padding = 25;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            let pathData = '';
            let areaPathData = '';
            
            gameData.priceHistory.forEach((point, index) => {
                const x = padding + (index / (gameData.priceHistory.length - 1)) * chartWidth;
                const y = padding + chartHeight - ((point.price - minPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    pathData += `M ${x} ${y} `;
                    areaPathData += `M ${x} ${height - padding} L ${x} ${y} `;
                } else {
                    pathData += `L ${x} ${y} `;
                    areaPathData += `L ${x} ${y} `;
                }
            });
            
            // –ó–∞–º—ã–∫–∞–µ–º –ø—É—Ç—å –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º
            areaPathData += `L ${width - padding} ${height - padding} Z`;
            
            // –†–∏—Å—É–µ–º –æ–±–ª–∞—Å—Ç—å –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º
            const areaPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            areaPath.setAttribute('d', areaPathData);
            areaPath.setAttribute('class', 'chart-area');
            chart.appendChild(areaPath);
            
            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –≥—Ä–∞—Ñ–∏–∫–∞
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData);
            path.setAttribute('class', 'chart-line');
            chart.appendChild(path);
            
            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
            const currentY = padding + chartHeight - ((gameData.coinPrice - minPrice) / priceRange) * chartHeight;
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', padding);
            line.setAttribute('y1', currentY);
            line.setAttribute('x2', width - padding);
            line.setAttribute('y2', currentY);
            line.setAttribute('class', 'current-price-line');
            chart.appendChild(line);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', width - padding - 10);
            label.setAttribute('y', currentY - 10);
            label.setAttribute('class', 'current-price-label');
            label.setAttribute('text-anchor', 'end');
            label.textContent = '‚ÇΩ' + gameData.coinPrice.toFixed(2);
            chart.appendChild(label);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –º–∏–Ω–∏–º—É–º–∞ –∏ –º–∞–∫—Å–∏–º—É–º–∞
            const minLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            minLabel.setAttribute('x', padding + 10);
            minLabel.setAttribute('y', height - padding - 10);
            minLabel.setAttribute('class', 'max-min-labels');
            minLabel.textContent = '‚ÇΩ' + minPrice.toFixed(2);
            chart.appendChild(minLabel);
            
            const maxLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            maxLabel.setAttribute('x', padding + 10);
            maxLabel.setAttribute('y', padding + 20);
            maxLabel.setAttribute('class', 'max-min-labels');
            maxLabel.textContent = '‚ÇΩ' + maxPrice.toFixed(2);
            chart.appendChild(maxLabel);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
            const timeLabels = [
                { index: 0, label: '5 –º–∏–Ω –Ω–∞–∑–∞–¥' },
                { index: Math.floor(gameData.priceHistory.length / 2), label: '2.5 –º–∏–Ω' },
                { index: gameData.priceHistory.length - 1, label: '–°–µ–π—á–∞—Å' }
            ];
            
            timeLabels.forEach(item => {
                if (item.index < gameData.priceHistory.length) {
                    const x = padding + (item.index / (gameData.priceHistory.length - 1)) * chartWidth;
                    const timeLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    timeLabel.setAttribute('x', x);
                    timeLabel.setAttribute('y', height - 5);
                    timeLabel.setAttribute('class', 'time-labels');
                    timeLabel.setAttribute('text-anchor', 'middle');
                    timeLabel.textContent = item.label;
                    chart.appendChild(timeLabel);
                }
            });
        }

        // –¢–æ—Ä–≥–æ–≤–ª—è
        function trade(action) {
            const amount = parseFloat(document.getElementById('amountInput').value);
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', true);
                return;
            }
            
            const totalCost = amount * gameData.coinPrice;
            
            if (action === 'buy') {
                if (gameData.balance >= totalCost) {
                    gameData.balance -= totalCost;
                    gameData.coins += amount;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª—å
                    gameData.portfolio.totalInvested += totalCost;
                    gameData.portfolio.totalCoins += amount;
                    
                    showNotification('–ö—É–ø–ª–µ–Ω–æ ' + amount.toFixed(2) + ' –º–æ–Ω–µ—Ç');
                    vkBridge.send('VKWebAppTapticImpactOccurred', {"style": "medium"});
                } else {
                    showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', true);
                    vkBridge.send('VKWebAppTapticNotificationOccurred', {"type": "error"});
                }
            } else if (action === 'sell') {
                if (gameData.coins >= amount) {
                    gameData.balance += totalCost;
                    gameData.coins -= amount;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª—å (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                    if (gameData.portfolio.totalCoins > 0) {
                        const avgPrice = gameData.portfolio.totalInvested / gameData.portfolio.totalCoins;
                        const soldValue = amount * avgPrice;
                        gameData.portfolio.totalInvested -= soldValue;
                        gameData.portfolio.totalCoins -= amount;
                        
                        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                        if (gameData.portfolio.totalInvested < 0) gameData.portfolio.totalInvested = 0;
                        if (gameData.portfolio.totalCoins < 0) gameData.portfolio.totalCoins = 0;
                    }
                    
                    showNotification('–ü—Ä–æ–¥–∞–Ω–æ ' + amount.toFixed(2) + ' –º–æ–Ω–µ—Ç');
                    vkBridge.send('VKWebAppTapticImpactOccurred', {"style": "medium"});
                } else {
                    showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç', true);
                    vkBridge.send('VKWebAppTapticNotificationOccurred', {"type": "error"});
                }
            }
            
            updateUI();
            saveGame();
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(text, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(updatePrice, 5000);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', drawChart);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        loadGame();
        
        // VK Bridge —Å–æ–±—ã—Ç–∏—è
        vkBridge.subscribe((e) => {
            if (e.detail.type === 'VKWebAppUpdateConfig') {
                document.body.style.backgroundColor = e.detail.data.scheme === 'bright_light' ? '#ffffff' : '#000000';
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>